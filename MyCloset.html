<html>
    <head>
        <script> src="Distant_Stroke.otf" </script>
        <style>
            body {
                background-image: url("backgrounds/closet_tryout.jpeg");
                background-size: cover;
                background-position: center;
                width:100%;
                height: 100%;
            }
            #first-line {
                height:15px;
                top:33%;
                background-color: white;
                width:100%;
                position: absolute;
                left:0;
                z-index:100;
            }
            #second-line {
                height:15px;
                top:66%;
                background-color: white;
                width:100%;
                position: absolute;
                left:0;
                z-index:100;
            }
            .buttimg{
                padding-left: 3%;
                padding-top: 5px;
                height:67px;
                float:left;
                }
            #tops{
                top:0%;
                height:33%;
                text-align: center;
                color:white;
                font-family: 'Courier New';
                font-size:30px;
                position: absolute;
                width: 100%;
            }
            #bottoms{
                top:33%;
                height:33%;
                text-align: center;
                color:white;
                font-family: 'Courier New';
                font-size:30px;
                position: absolute;
                width: 100%;
            }
            #shoes{
                top:66%;
                height:33%;
                text-align: center;
                color:white;
                font-family: 'Courier New';
                font-size:30px;
                 position: absolute;
                width: 100%;
            }
            #add-tops{
                float:left;
            }
            #add-bottoms{
                float: left;
            }
            #add-shoes {
                float:left;
            }
 
            /*.stores{
            bottom:0;
            } */
            /*.button{
                padding-left: 20px;
                padding-right:100px;
                padding-top: 90px;
            }*//*.stores{
        bottom:0;
    } */
            .button_image{
                padding:0px;
                float:left;
                width:9%; 
                height:auto;
                 -webkit-transform: rotate(-20deg);
            }

        </style>
    </head>
    <body>
        <div id="first-line"></div>
        <div id="second-line"></div>
        <div id="tops">
            <h2> Tops and Dresses</h2>
            <input class= "button" id= "add-tops" type="file" onchange="showimage('tops')">
        </div>
        <a href="index.html" class="butt" id="Go_Home">
            <img class="button_image" src = "button/hangerz.png">
        </a>
        <div id="bottoms">
            <h2> Bottoms </h2>
            <!-- <form class= "button" id= "add-bottom">
                <image class="buttimg" src= "plus_sign.png"></image> -->
            <input class= "button" id= "add-bottoms" type="file" onchange="showimage('bottoms')">
          <!--   </form> -->
        </div>
        <div id = "shoes">
            <h2> Shoes and Accessories </h2>
            <!-- <form class= "button" id= "add-shoes">
                <image class="buttimg" src= "plus_sign.png"></image> -->
            <input class= "button" id= "add-shoes" type="file" onchange="showimage('shoes')">
            <!-- </form> -->
        </div>
        <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
        <script type="text/javascript">
            var tops = getStoredPics("tops");
            var id = "tops";
                if (tops.length > 0) {
                    for (var i = 0; i < tops.length; i++) {
                        var $toAdd = $("#tops");
                        $toAdd.append('<div id="newItem'+id+i+'" style="position: relative; float: left; height: 45%; padding-left:10px; width: 8%; bottom: 35px;"><img src="'+tops[i]+'" id="adding-'+id+i+'" style="left: 0; top:0px; height: 100%; width: 95%; position: absolute;"><img id="ootd-button'+id+i+'" src="button/addButton.png" onclick="showOotdWindow(\'' + id  + i + '\')" style="width: 20px; height: 20px; left: 0; position: absolute; bottom: 0;"><img id="delete-button'+id+i+'" src="button/deleteButton.png" onclick="showDeleteWindow(\'' + id  + i + '\')" style="width: 20px; height: 20px; right: 0; position: absolute; bottom: 0;"></div>');
                    }
                }
            var bottoms = getStoredPics("bottoms");
            id = "bottoms";
                if (bottoms.length > 0) {
                    for (var i = 0; i < bottoms.length; i++) {
                        var $toAdd = $("#bottoms");
                        $toAdd.append('<div id="newItem'+id+i+'" style="position: relative; float: left; height: 45%; padding-left:10px; width: 8%; bottom: 35px;"><img src="'+bottoms[i]+'" id="adding-'+id+i+'" style="left: 0; top:0px; height: 100%; width: 95%; position: absolute;"><img id="ootd-button'+id+i+'" src="button/addButton.png" onclick="showOotdWindow(\'' + id  + i + '\')" style="width: 20px; height: 20px; left: 0; position: absolute; bottom: 0;"><img id="delete-button'+id+i+'" src="button/deleteButton.png" onclick="showDeleteWindow(\'' + id  + i + '\')" style="width: 20px; height: 20px; right: 0; position: absolute; bottom: 0;"></div>');
                    }
                }
            var shoes = getStoredPics("shoes");
            id = "shoes";
                if (shoes.length > 0) {
                    for (var i = 0; i < shoes.length; i++) {
                        var $toAdd = $("#shoes");



                        $toAdd.append('<div id="newItem'+id+i+'" style="position: relative; float: left; height: 45%; padding-left:10px; width: 8%; bottom: 35px;"><img src="'+shoes[i]+'" id="adding-'+id+i+'" style="left: 0; top:0px; height: 100%; width: 95%; position: absolute;"><img id="ootd-button'+id+i+'" src="button/addButton.png" onclick="showOotdWindow(\'' + id  + i + '\')" style="width: 20px; height: 20px; left: 0; position: absolute; bottom: 0;"><img id="delete-button'+id+i+'" src="button/deleteButton.png" onclick="showDeleteWindow(\'' + id  + i + '\')" style="width: 20px; height: 20px; right: 0; position: absolute; bottom: 0;"></div>');


                        // $toAdd.append('<div id="newItem'+id+i+'" style="position: relative; float: left; height: 45%; padding-left:10px; width: 8%; bottom: 35px;"><img src="'+shoes[i]+'" id="adding-'+id+i+'" style="left: 0; top:0px; height: 100%; width: 100%; position: absolute;"><img id="ootd-button'+id+i+'" src="addButton.png" onclick="showOotdWindow("'+id+i+'")" style="width: 20px; height: 20px; left: 0; position: absolute; bottom: 0;"><img id="delete-button'+id+i+'" src="deleteButton.png" onclick="alert(\'yo\')" style="width: 20px; height: 20px; right: 0; position: absolute; bottom: 0;"></div>');
                    }
                }
            function test() {
                alert("test")
            }


            function getStoredPics(types) {
                if (types === "tops") {
                    //console.log("hihihihih");
                    if (!localStorage.tops) {
                        // default to empty array
                        localStorage.tops = JSON.stringify([]);
                    }
                    return JSON.parse(localStorage.tops);
                }
                else if (types === "bottoms") {
                    if (!localStorage.bottoms) {
                        // default to empty array
                        localStorage.bottoms = JSON.stringify([]);
                    }
                    return JSON.parse(localStorage.bottoms);
                }
                else {
                    if (!localStorage.shoes) {
                        // default to empty array
                        localStorage.shoes = JSON.stringify([]);
                    }
                    return JSON.parse(localStorage.shoes);
                }
            }
            // function getNumFiles() {
            //     if (!localStorage.num) {
            //         // default to empty array
            //         localStorage.num = JSON.stringify(0);
            //     }

            //     return JSON.parse(localStorage.num);
            // }
            function showimage(id){
                  // var preview = document.querySelector('img'); //selects the query named img
                   var pics = getStoredPics(id);
                   //var numFiles = getNumFiles();
                   var getting = "";
                   //console.log($('#add-'+id+''));
                   //console.log(pics);
                   //console.log(document.querySelector('#add-'+id+''));
                   var file = document.querySelector('#add-'+id+'').files[0]; //sames as here
                   //console.log(file);
                   var reader  = new FileReader();
                   reader.onloadend = function () {
                        // var $toAdd = $("#"+id+"");
                        // var num = pics.length;
                        // $toAdd.append('<div id="newItem'+id+num+'" style="position: relative; float: left; height: 45%; padding-left:10px; width: 8%; bottom: 35px;"><img src="'+reader.result+'" id="adding-'+id+num+'" style="left: 0; top:0px; height: 100%; width: 90%; position: absolute;"><img id="ootd-button'+id+num+'" src="button/addButton.png" onclick="showOotdWindow(\'' + id  + i + '\')" style="width: 20px; height: 20px; left: 0; position: absolute; bottom: 0;"><img id="delete-button'+id+num+'" src="button/deleteButton.png" onclick="showDeleteWindow(\'' + id  + i + '\')" style="width: 20px; height: 20px; right: 0; position: absolute; bottom: 0;"></div>');
                        pics.push(reader.result);
                        //numFiles++;
                        var delay = 250;
                        if (id === "tops") {
                            localStorage.tops = JSON.stringify(pics);
                            setTimeout(function() {
                                window.location.href=window.location.href;
                            }, delay);
                        }
                        else if (id === "bottoms") {
                            localStorage.bottoms = JSON.stringify(pics);
                            setTimeout(function() {
                                window.location.href=window.location.href;
                            }, delay);
                        }
                        else {
                            localStorage.shoes = JSON.stringify(pics);
                            setTimeout(function() {
                                window.location.href=window.location.href;
                            }, delay);
                          // document.getElementById("Tops").appendChild('<img src="'+reader.result+'">');
                           // preview.src = reader.result;
                       }
                  };

                   if (file) {
                       reader.readAsDataURL(file); //reads the data as a URL
                   } else {
                       console.log("file not exist??");
                   }
              }
              function showOotdWindow(index) {
                //console.log(index)
                //console.log("got ehre");
                var question = "";
                var count = 0;
                for (var i=0; i<index.length; i++) {
                    if(!isNaN(parseInt(index.slice(i,i+1)))) {
                        break;
                    }
                    count++;
                }
                //console.log($("#adding-"+index+"")[0]);
                var currPic = $("#adding-"+index+"")[0].src;
                //console.log("add to be ootd: " + currPic);
                var type = index.slice(0,count);
                console.log(type);
                if (type === "tops") {
                    question = "Are you sure you want to make this your top/dress of the day?";
                }
                else if (type === "bottoms") {
                    question = "Are you sure you want to make these your bottoms of the day?";
                }
                else {
                    question = "Are you sure you want to make these your shoes/accessories of the day?";
                }
                if (!localStorage.ootd) {
                    // default to empty array
                    localStorage.ootd = JSON.stringify(["","",""]);
                }
                var ootds = JSON.parse(localStorage.ootd);
                if (confirm(question) === false) {
                    console.log("You pressed Cancel!");
                } 
                else {
                    if (type === "tops") {
                        ootds[0] = currPic;
                        console.log("added top");
                    }
                    else if (type === "bottoms") {
                        ootds[1] = currPic;
                        console.log("added bottom");
                    }
                    else {
                        ootds[2] = currPic;
                        console.log("added shoes");
                    }
                    //console.log("top: " + ootds[0]);
                    //console.log("bottoms: " + ootds[1]);
                    //console.log("shoes: " + ootds[2]);
                    try{
                        localStorage.ootd = JSON.stringify(ootds);
                    } catch(e) {
                        alert("This photo is too big and cannot be set to your Outfit of the Day. Try another one? \n \nThe Error Message:\n" + e);
                    }
                }
            }
            function showDeleteWindow(index) {
                //console.log("got here");
                var question = "";
                if (type === "tops") {
                    question = "Are you sure you want to delete this top/dress?";
                }
                else if (type === "bottoms") {
                    question = "Are you sure you want to delete these bottoms?";
                }
                else {
                    question = "Are you sure you want to delete these shoes/accessories?";
                }
                if (confirm(question) === false) {
                    console.log("You pressed Cancel!");
                } 
                else {
                    var count = 0;
                    for (var i=0; i<index.length; i++) {
                        if(!isNaN(parseInt(index.slice(i,i+1)))) {
                            break;
                        }
                        count++;
                    }
                    var currPic = $("#adding-"+index+"")[0].src;
                    //console.log("add to be ootd: " + currPic);
                    var type = index.slice(0,count);
                    //console.log(type);
                    var pics = removePic(currPic, getStoredPics(type));
                    //console.log(pics);
                    var delay = 500;
                    if (type === "tops") {
                        localStorage.tops = JSON.stringify(pics);
                        setTimeout(function() {
                            window.location.href=window.location.href;
                        }, delay);
                    }
                    else if (type === "bottoms") {
                        localStorage.bottoms = JSON.stringify(pics);
                        setTimeout(function() {
                            window.location.href=window.location.href;
                        }, delay);
                        //location.reload(true);
                    }
                    else {
                        localStorage.shoes = JSON.stringify(pics);
                        setTimeout(function() {
                            window.location.href=window.location.href;
                        }, delay);
                        //location.reload(true);
                   }   
                }
            }
            function removePic(currPic, pics) {
                //console.log(pics);
                for (var i = 0; i < pics.length; i++) {
                        if(pics[i] === currPic) {
                            pics.splice(i,1);
                        }
                    }
                return pics;
            }
        </script>
    </body>    
</html>  
